import os
import yt_dlp as youtube_dl
from googleapiclient.discovery import build
from moviepy.editor import VideoFileClip, clips_array

# Function to get video URLs from YouTube based on a query and number of results
def get_youtube_video_urls(api_key, query="Minecraft parkour", max_results=5):
    youtube = build('youtube', 'v3', developerKey=api_key)
    request = youtube.search().list(
        q=query, part="id,snippet", type="video", order="viewCount", maxResults=max_results
    )
    response = request.execute()
    
    video_urls = []
    for item in response.get("items", []):
        video_id = item["id"]["videoId"]
        video_urls.append(f"https://www.youtube.com/watch?v={video_id}")
    
    return video_urls

# Function to download a YouTube video given a URL and output path
def download_video(url, output_path):
    options = {
        'format': 'best',
        'outtmpl': output_path,
    }
    with youtube_dl.YoutubeDL(options) as ydl:
        ydl.download([url])

# Function to create a split-screen video
def create_split_screen_video(clip1_path, clip2_path, output_path):
    clip1 = VideoFileClip(clip1_path)
    clip2 = VideoFileClip(clip2_path)
    
    # Resize both clips to have the same height
    clip1_resized = clip1.resize(height=360)
    clip2_resized = clip2.resize(height=360)
    
    # Synchronize the duration of both clips
    min_duration = min(clip1_resized.duration, clip2_resized.duration)
    clip1_resized = clip1_resized.subclip(0, min_duration)
    clip2_resized = clip2_resized.subclip(0, min_duration)
    
    # Combine both clips into a split-screen format
    final_clip = clips_array([[clip1_resized, clip2_resized]])
    
    # Write the final video to a file
    final_clip.write_videofile(output_path, codec="libx264", fps=24)

# Main function to download videos and create a split-screen video
def main():
    api_key = 'YOUR_YOUTUBE_API_KEY'  # Replace with your YouTube API key
    video_urls = get_youtube_video_urls(api_key)
    
    # Download the first two Minecraft parkour videos (or any video content)
    download_video(video_urls[0], 'clip1.mp4')
    download_video(video_urls[1], 'clip2.mp4')
    
    # Create the split-screen video from the downloaded clips
    create_split_screen_video('clip1.mp4', 'clip2.mp4', 'split_screen_parkour.mp4')

    # Clean up downloaded video files
    os.remove('clip1.mp4')
    os.remove('clip2.mp4')

    print("Split-screen video created successfully: split_screen_parkour.mp4")

# Run the main function
if __name__ == '__main__':
    main()
